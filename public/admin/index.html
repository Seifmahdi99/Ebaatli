<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ebaatli Admin — Login</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="styles/main.css" />
  <style>
    body { display: flex; align-items: center; justify-content: center; min-height: 100vh; }
    .login-card {
      background: var(--card-bg);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 48px 40px;
      width: 100%;
      max-width: 420px;
      box-shadow: 0 25px 60px rgba(0,0,0,0.5);
      backdrop-filter: blur(20px);
      animation: slideUp 0.5s ease;
    }
    @keyframes slideUp {
      from { opacity:0; transform: translateY(30px); }
      to   { opacity:1; transform: translateY(0); }
    }
    .login-logo { text-align: center; margin-bottom: 36px; }
    .login-logo .logo-icon {
      width: 60px; height: 60px; background: var(--gradient);
      border-radius: 16px; margin: 0 auto 16px;
      display: flex; align-items: center; justify-content: center;
      font-size: 28px; box-shadow: 0 8px 24px rgba(139,92,246,0.4);
    }
    .login-logo h1 { font-size: 1.6rem; font-weight: 700; margin: 0; }
    .login-logo p  { color: var(--text-muted); font-size: 0.875rem; margin: 6px 0 0; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; font-size: 0.8rem; font-weight: 600; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.06em; margin-bottom: 8px; }
    .form-group input {
      width: 100%; padding: 12px 16px; background: var(--input-bg);
      border: 1px solid var(--border); border-radius: 10px;
      color: var(--text); font-size: 0.95rem; font-family: inherit;
      outline: none; transition: border-color 0.2s, box-shadow 0.2s;
      box-sizing: border-box;
    }
    .form-group input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(139,92,246,0.15); }
    .btn-login {
      width: 100%; padding: 13px; background: var(--gradient);
      border: none; border-radius: 10px; color: #fff;
      font-size: 1rem; font-weight: 600; font-family: inherit;
      cursor: pointer; transition: opacity 0.2s, transform 0.15s;
      box-shadow: 0 4px 16px rgba(139,92,246,0.4);
    }
    .btn-login:hover { opacity: 0.92; transform: translateY(-1px); }
    .btn-login:active { transform: translateY(0); }
    .error-msg {
      display: none; background: rgba(239,68,68,0.12);
      border: 1px solid rgba(239,68,68,0.35); border-radius: 8px;
      padding: 10px 14px; color: #f87171; font-size: 0.85rem;
      margin-bottom: 16px; text-align: center;
    }
    .error-msg.show { display: block; }
  </style>
</head>
<body>
  <div class="login-card">
    <div class="login-logo">
      <div class="logo-icon">⚡</div>
      <h1>Ebaatli Admin</h1>
      <p>Platform Control Panel</p>
    </div>
    <div class="error-msg" id="errorMsg">Invalid admin key. Please try again.</div>
    <div class="form-group">
      <label>Admin API Key</label>
      <input type="password" id="apiKeyInput" placeholder="Enter your admin key…" autocomplete="current-password" />
    </div>
    <button class="btn-login" id="loginBtn">Enter Dashboard →</button>
  </div>

  <script src="js/auth.js"></script>
  <script>
    const loginBtn   = document.getElementById('loginBtn');
    const apiKeyInput = document.getElementById('apiKeyInput');
    const errorMsg   = document.getElementById('errorMsg');

    // If already logged in, go straight to dashboard
    if (localStorage.getItem('adminKey')) {
      window.location.href = 'dashboard.html';
    }

    async function doLogin() {
      const key = apiKeyInput.value.trim();
      if (!key) return;

      loginBtn.textContent = 'Verifying…';
      loginBtn.disabled = true;
      errorMsg.classList.remove('show');

      try {
        const res = await fetch('/admin/auth/verify', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ key })
        });

        if (res.ok) {
          localStorage.setItem('adminKey', key);
          window.location.href = 'dashboard.html';
        } else {
          errorMsg.classList.add('show');
          loginBtn.textContent = 'Enter Dashboard →';
          loginBtn.disabled = false;
        }
      } catch {
        errorMsg.textContent = 'Cannot reach server. Is the backend running?';
        errorMsg.classList.add('show');
        loginBtn.textContent = 'Enter Dashboard →';
        loginBtn.disabled = false;
      }
    }

    loginBtn.addEventListener('click', doLogin);
    apiKeyInput.addEventListener('keydown', e => e.key === 'Enter' && doLogin());
  </script>
</body>
</html>
